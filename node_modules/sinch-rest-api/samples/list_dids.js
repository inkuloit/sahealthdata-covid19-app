// This sample shows how to authenticate as a Sinch Partner and use the API's to list available DID's
// This sample is not prepared to be easily browserified, since in this scenario it makes little sense

var sinchRestApi = require('../index.js')(); // Start sinchRestApi with fundamental credentials

var email = process.argv[2];
var password = process.argv[3];

if(!email) {
	throw new Error('Pass email and password as command line options.')
}

var consoleOut = function(result) { console.log(result); }
var consoleError = function(result) { console.error(result); }

sinchRestApi.user.authenticate({email: email, password: password}) // Auth user & get auth ticket
	.then(sinchRestApi.base.getInstance) // Exchange ticket for instance
	.then(sinchRestApi.pushInstance.bind(sinchRestApi)) // Push instance to use as credentials in future requests
	.then(sinchRestApi.base.getOrganisations) // Make a request as authenticated user
	.then(function selectOrg(organisations){return organisations[0];}) // One user can have multiple organisations (currently only 1 is ever used)
	.then(sinchRestApi.portal.getNumberPools) // Retrieve numbers for given organisation (see papi/portal_defs.jsfor definition of getNumberPools)
	.then(consoleOut)
	.fail(consoleError)
